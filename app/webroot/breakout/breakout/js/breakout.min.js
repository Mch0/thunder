/*!***********************
 *                       *
 *      BREAKOUT 1.0     *
 *                       *
 *  (C) Lukas Prvy 2012  *
 *                       *
 *************************/

(function(h){var g={texts:{score:"SCORE",level:"LEVEL",balls:"BALLS",paused:"PAUSED",win:"YOU WON!",gameover:"GAME OVER"},include:{code:["css/awesome.css","js/imgload.js"],sounds:[{name:"music",channels:1},{name:"bounce",channels:8},{name:"brick",channels:8},{name:"laser",channels:4},{name:"fail",channels:3},{name:"applause",channels:1},{name:"gameover",channels:1}],images:["background.png","ball.png","bricks.png","laser.gif","paddle.png","panel.png","powerup.png","powerup_e.gif","powerup_f.gif","powerup_l.gif","powerup_p.gif","powerup_s.gif","powerup_t.gif"]},settings:{sound:true,music:true},save:function(){if(window.JSON){l.set("breakout_settings",JSON.stringify(g.settings))}},restore:function(){if(window.JSON){var o=l.get("breakout_settings");if(o){g.settings=JSON.parse(o)}}}};var m={path:"breakout/",running:false,levels:[],width:0,height:0,level:1,score:0,balls:5,play:function(){a.message(false);if(!m.balls||m.level>m.levels.length){m.reset();b.refresh();d.hide()}m.running=true;a.refresh()},pause:function(){m.running=false;a.message(g.texts.paused);a.refresh()},toggle:function(o){o=typeof o=="undefined"?!m.running:o;m[o?"play":"pause"]()},reset:function(){m.score=0;m.level=1;m.balls=5;f.reset();i.center();m.running=true},fail:function(){k.play("fail");if(!f.count){i.keys.space=false;e.reset();c.hide();f.speed.current=f.speed.normal;i.type="normal";if(!--m.balls){m.running=false;k.play("gameover");d.show(g.texts.gameover)}else{f.reset()}a.refresh()}},uselessBrowser:function(){if(h.browser.msie&&h.browser.version<8){m.$container.addClass("breakoutInfo").html(["This outdated browser is not supported. ","Use any of the modern browsers: ",'<a href="https://www.google.com/intl/en/chrome/browser/">',"    Chrome","</a>, ",'<a href="http://www.mozilla.org/en-US/firefox/new/">',"    Firefox","</a>, ",'<a href="http://www.opera.com/download/">',"    Opera","</a>, ",'<a href="http://support.apple.com/kb/DL1531">',"    Safari","</a>, ",'<a href="http://windows.microsoft.com/en-US/internet-explorer/downloads/ie-9/worldwide-languages">',"    IE9","</a>."].join("")).trigger("load");return true}return false},preload:function(q,r){var p=window.devicePixelRatio&&devicePixelRatio==2;q=h.map(q,function(s){return(m.path+(p?"img/2x":"img")+"/"+s)});var o=h([]);h.each(q,function(t,s){o=o.add('<img src="'+s+'" />')});if(h.browser.opera){o.css("visibility","hidden").appendTo("body").remove()}o.imagesLoaded(r||h.noop)},include:function(r,s){var o=4;function p(){if(!--o){s()}}k.init(r.sounds,p);var q=r.code.length;while(r.code.length){yepnope({load:m.path+r.code.pop(),callback:function(){if(!--q){p();m.preload(r.images,p)}}})}h.getJSON(m.path+"js/levels.json",function(t){m.levels=t;p()})},gameplay:function(){if(m.running){i.move();f.move();c.move();e.move()}setTimeout(m.gameplay,1000/60)},refresh:function(){requestAnimationFrame(m.refresh);if(m.running){i.refresh();f.refresh();c.refresh();e.refresh()}},render:function(){m.$screen=h('<div id="breakoutScreen"></div>').appendTo(m.$container);m.width=m.$screen.width();m.height=m.$screen.height();m.$bricks=b.render().appendTo(m.$screen);m.$laser=c.render().appendTo(m.$screen);m.$paddle=i.render().appendTo(m.$screen);m.$panel=a.render().appendTo(m.$container)},init:function(){m.$container=h("#breakout");if(!m.$container.length){m.$container=h('<div id="breakout" />').appendTo("body")}if(h.browser.msie){m.$container.attr("data-ie",parseInt(h.browser.version))}m.$container.disableSelection();m.$info=d.render().appendTo(m.$container);if(m.uselessBrowser()){return}window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(p){setTimeout(p,1000/60)};var o=h('script[src$="breakout.js"], script[src$="breakout.min.js"]');if(o.length){m.path=o.attr("src").replace("js/breakout.js","").replace("js/breakout.min.js","")}m.include(g.include,function(){m.render();f.init();c.init();i.init();e.init();a.init();b.refresh();g.restore();k.mute(g.settings.sound);if(g.settings.music){k.loop("music")}m.running=true;m.gameplay();m.refresh();d.hide(function(){m.$container.addClass("breakoutLoaded")})},".control")}};var l={set:function(q,r,o){var p=new Date();p.setDate(p.getDate()+o);o=!o?"":";expires="+p.toUTCString();document.cookie=q+"="+escape(r)+o},get:function(o){if(document.cookie.length){var p=document.cookie.indexOf(o+"=");if(p!=-1){p+=o.length+1;end=document.cookie.indexOf(";",p);if(end==-1){end=document.cookie.length}return unescape(document.cookie.substring(p,end))}}return null}};var k={items:{},get:function(p){var o=k.items[p].channel;if(o==k.items[p].channels.length-1){k.items[p].channel=0}else{k.items[p].channel=o+1}return k.items[p].channels[o]},mute:function(p){if(!window.Audio){return}p=typeof p=="undefined"?!g.settings.sound:p;var o=p?1:0;h.each(k.items,function(r,q){if(r!="music"){h.each(q.channels,function(t,s){s.volume=o})}});a.refresh();g.settings.sound=p;g.save()},pause:function(q,p){if(!window.Audio){return}if(typeof q=="string"){p=q;q=undefined}var o=0;h.each(k.items[p].channels,function(s,r){if(r.currentTime){q=typeof q=="undefined"?!r.paused:q;r[q?"pause":"play"]();o++}});if(!o){k[p=="music"?"loop":"play"](p)}if(p=="music"){g.settings.music=!q;a.refresh();g.save()}},play:function(o){if(!window.Audio){return}try{o=k.get(o);o.currentTime=0;o.play()}catch(p){}},loop:function(o){if(!window.Audio){return}h.each(k.items[o].channels,function(q,p){p.addEventListener("ended",function(){this.currentTime=0;k.play(o)},false)});k.play(o)},init:function(q,r){if(!window.Audio){r();return}var o=(h.browser.safari||h.browser.msie)?"mp3":"ogg";var p=q.length;h.each(q,function(u,s){k.items[s.name]={channels:[],channel:0};var t=new Audio(m.path+"sound/"+s.name+"."+o);t.load();if(s.channels==1){k.items[s.name].channels.push(t);t.addEventListener("canplaythrough",function(){if(!--p){r()}},false)}else{document.body.appendChild(t);t.addEventListener("canplaythrough",function(){for(var v=0;v<s.channels;v++){k.items[s.name].channels.push(t.cloneNode(true))}if(!--p){r()}},false)}})}};var d={speed:750,show:function(o,p){d.toggle(true,o,p)},hide:function(o){d.toggle(false,o)},toggle:function(p,o,q){p=typeof p=="undefined"?!m.$info.is(":visible"):p;if(h.isFunction(o)){q=o}else{o=o||"";q=q||h.noop}a.controls.play.enabled=false;a.refresh();if(p){c.hide();e.reset();i.refresh();m.$info.text(o)}m.$info.stop(true,true)["fade"+(p?"In":"Out")](d.speed,function(){q();a.controls.play.enabled=true;a.refresh();if(!p){m.running=true}})},render:function(){return h('<div id="breakoutInfo"></div>')}};function j(){this.top=0;this.left=0;this.right=0;this.bottom=0;this.x=0;this.y=0;this.rx=0;this.ry=0;this.visible=false;var o=h('<div class="breakoutBall" />').appendTo(m.$screen);f.size=f.size||o.width();this.show=function(){this.toggle(true)};this.hide=function(){this.toggle(false)};this.toggle=function(p){f.count+=p!=this.visible?(p?1:-1):0;if(typeof p!="undefined"){this.visible=p}if(!p){this.x=this.y=0}};this.move=function(){if(!this.visible){return}if(f.paddle){this.left=Math.round(i.left+(i.width-f.size)/2);this.top=m.height-i.height-f.size}else{this.right=this.left+f.size;this.bottom=this.top+f.size;if(this.edges()){this.hide();this.refresh();m.fail()}else{this.right=this.left+f.size;this.bottom=this.top+f.size;this.paddle();this.bricks()}this.top+=this.y*f.speed.current+this.rx;this.left+=this.x*f.speed.current+this.ry}};this.fire=function(){f.paddle=true;this.move();this.x=!Math.round(Math.random()*1)?-5:5;this.y=-8;f.paddle=false};this.edges=function(){if(this.bottom>=m.height){return true}if(this.left<=0){this.left=0;this.x*=-1;k.play("bounce")}if(this.right>=m.width){this.left=m.width-f.size;this.x*=-1;k.play("bounce")}if(this.top<=0){this.top=0;this.y*=-1;k.play("bounce")}return false};this.paddle=function(){if(this.y>0){if(this.right>=i.left&&this.left<=i.right&&this.bottom>=i.top){this.x=16*(((this.left+f.size/2)-(i.left+i.width/2))/i.width);this.x=Math.abs(this.x)<2?2*(this.x<0?-1:1):this.x;this.y=-Math.min(12-Math.abs(this.x),8);this.rx=this.ry=0;k.play("bounce")}}};this.bricks=function(){function s(L,G,K,y,J,x,I,M,H){if(L&&(y-G>J-K&&M-x<H-I||y-G<J-K&&M-x>H-I)){return false}return !(x>y||M<G||I>J||H<K)}var D=Math.round((this.top+this.y-b.brick.height)/b.brick.height);var r=Math.round((this.left+this.x-b.brick.width)/b.brick.width);var q=Math.round((this.right+this.x+b.brick.width)/b.brick.width);var A=Math.round((this.bottom+this.y+b.brick.height)/b.brick.height);if(D<b.height){var F=false;var E=false;var B=Math.abs(this.x);var w=Math.abs(this.y);var v=b.brick.width/4;var t=b.brick.height/4;var p=false;D=D<0?0:D;r=r<0?0:r;r=r>=b.width?b.width-1:r;q=q>=b.width?b.width-1:q;A=A>=b.height?b.height-1:A;for(var z=D;z<=A;z++){for(var C=r;C<=q;C++){if(b.bricks[z][C]){var u=b.coords[z][C];if(s(false,this.left+this.x,this.top+this.y,this.right+this.x,this.bottom+this.y,u.left,u.top,u.right,u.bottom)){p=true;if(s(true,this.right,this.top,this.right+B,this.bottom,u.left,u.top,u.left+v,u.bottom)||s(true,this.left-B,this.top,this.left,this.bottom,u.right-v,u.top,u.right,u.bottom)){F=true}if(s(true,this.left,this.bottom,this.right,this.bottom+w,u.left,u.top,u.right,u.top+t)||s(true,this.left,this.top-w,this.right,this.top,u.left,u.bottom-t,u.right,u.bottom)){E=true}b.crack(C,z)}}}}if(p){this.rx=Math.random()*0.2;this.ry=Math.random()*0.2;if(!F&&!E){!Math.round(Math.random()*1)?F=true:E=true}}this.x*=F?-1:1;this.y*=E?-1:1}},this.refresh=function(){o.css({top:this.top,left:this.left}).toggle(this.visible)}}var f={items:[],speed:{slow:0.65,normal:0.82,fast:1,current:0.82},count:0,size:0,paddle:true,each:function(o){for(var p in f.items){f.items[p][o]()}},move:function(){f.each("move")},refresh:function(){f.each("refresh")},hide:function(){f.each("hide");f.each("refresh")},reset:function(){f.each("hide");f.paddle=true;f.items[0].show();f.refresh();f.speed.current=f.speed.normal;e.countdown(false)},init:function(){for(var o=0;o<3;o++){f.items.push(new j())}f.reset()}};function n(o,p){this.render=function(){return h(["<div",'    data-type="'+this.type+'"','    class="breakoutPowerup"',">",'    <div class="breakoutAnimation"></div>',"</div>"].join(""))};this.refresh=function(){this.$powerup.css({top:this.top,left:this.left})};this.move=function(){this.top+=e.speed;this.right=this.left+e.width;this.bottom=this.top+e.height};this.check=function(){if(f.move&&this.right>=i.left&&this.left<=i.right&&this.bottom>=i.top){e.use(this.type);return false}else{if(this.bottom>=m.height){return false}}return true};this.top=p;this.left=o;do{this.type=e.type()}while(e.last==this.type);e.last=this.type;this.$powerup=this.render().appendTo(m.$screen);this.refresh();this.$powerup.fadeIn(250)}var e={speed:4,max:3,width:0,height:0,last:"",items:[],timer:{type:null,duration:10000,time:0},each:function(o,q){q=q||h.noop;for(var p in e.items){e.items[p][o]();q(p)}},move:function(){var o=[];e.each("move",function(r){if(!e.items[r].check()){o.push(r)}});if(o.length){for(var q in o){var p=o[q];e.items[p].$powerup.remove();delete e.items[p]}e.items=h.grep(e.items,function(r){return !!r})}},reset:function(){e.countdown(false);for(var o in e.items){e.items[o].$powerup.remove();delete e.items[o]}e.items=[];i.type="normal"},refresh:function(){e.each("refresh")},add:function(o,q){if(e.items.length<e.max){o=o*b.brick.width+Math.round((b.brick.width-e.width)/2);var p=true;h.each(e.items,function(s,r){return p=o!=r.left});if(p){q=q*b.brick.height+Math.round((b.brick.height-e.height)/2);e.items.push(new n(o,q))}}},countdown:function(o){if(o===false){e.timer.type=false;e.timer.time=0}else{if(o){if(e.timer.type==o){e.timer.time=e.timer.time+e.timer.duration}else{e.timer.time=e.timer.duration}e.timer.type=o;setTimeout(e.countdown,1000)}else{if(e.timer.type){e.timer.time-=1000;if(e.timer.time>0){setTimeout(e.countdown,1000)}else{e.timer.time=0;f.speed.current=f.speed.normal}}}}},type:function(){var o=Math.floor(Math.random()*17);if(o<=3){o="e"}else{if(o<=7){o="t"}else{if(o<=10){o="s"}else{if(o<=13){o="f"}else{if(o<=15){o="l"}else{o="p"}}}}}return o},use:function(o){m.score++;a.refresh();switch(o){case"e":i.type="long";break;case"t":if(f.count==3){return}var q=false;for(var r in f.items){var p=f.items[r];if(!p.visible){p.left=Math.round(i.left+(i.width-f.size)/2);p.top=m.height-i.height-f.size;p.x=q?5:-5;p.y=-8;p.show();q=!q}}break;case"l":i.type="laser";break;case"s":f.speed.current=f.speed.slow;e.countdown("s");break;case"f":f.speed.current=f.speed.fast;e.countdown("f");break;case"p":m.balls++;a.refresh();a.highlight('[data-value="balls"] .breakoutValue')}i.refresh()},init:function(){var o=h('<div class="breakoutPowerup" />').appendTo(m.$screen);e.width=o.width();e.height=o.height();o.remove()}};var c={speed:16,visible:false,top:0,left:0,right:0,width:0,height:0,fire:function(){if(!c.visible){k.play("laser");c.top=i.top-c.height;c.left=i.left+Math.round((i.width-c.width)/2);c.show()}},collision:function(){function p(z,B,x,A,v,y,u,w){return !(v>x||u<z||y>A||w<B)}var t=Math.round((c.top-c.speed)/b.brick.height);var r=Math.round((c.left-b.brick.width)/b.brick.width);var q=Math.round((c.right+b.brick.width)/b.brick.width);if(t<b.height){t=t<0?0:t;r=r<0?0:r;r=r>=b.width?b.width-1:r;q=q>=b.width?b.width-1:q;for(var o=r;o<=q;o++){if(b.bricks[t][o]){var s=b.coords[t][o];if(p(c.left,c.top-c.speed,c.right,c.bottom-c.speed,s.left,s.top,s.right,s.bottom)){b.crack(o,t,true);c.hide()}}}}},move:function(){if(i.type=="laser"&&i.keys.space&&!f.paddle){c.fire()}if(!c.visible){return}if(c.top<=0){c.hide();return}c.right=c.left+c.width;c.bottom=c.top+c.height;if(!c.collision()){c.top-=c.speed}},show:function(){c.toggle(true)},hide:function(){c.toggle(false)},toggle:function(o){m.$laser.toggle(o);c.visible=o},refresh:function(){m.$laser.css({top:c.top,left:c.left})},render:function(){return h('<div id="breakoutLaser" />')},init:function(){c.width=m.$laser.width();c.height=m.$laser.height()}};var i={type:"normal",speed:11,left:0,top:0,right:0,width:0,height:0,keys:{left:false,right:false,space:false},move:function(){if(i.keys.left||i.keys.right&&i.keys.left!=i.keys.right){i.left-=i.keys.left?i.speed:0;i.left+=i.keys.right?i.speed:0}if(i.keys.space&&m.running&&f.paddle){f.items[0].fire()}},center:function(){i.left=Math.round((m.width-i.width)/2)},refresh:function(){var o=m.$paddle.attr("data-type");m.$paddle.attr("data-type",i.type);if(h.browser.msie&&h.browser.version==8){m.$paddle.css("margin-left",1).css("margin-left",0)}if(o!=i.type){i.width=m.$paddle.width()}if(i.left<0){i.left=0}else{if(i.left+i.width>m.width){i.left=m.width-i.width}}m.$paddle.css("left",i.left);i.right=i.left+i.width;if(f.paddle){f.move();f.refresh()}},render:function(){return h(["<div",'    id="breakoutPaddle"','    data-type="normal"',">",'    <div class="breakoutLeft"></div>','    <div class="breakoutMiddle"></div>','    <div class="breakoutRight"></div>',"</div>"].join(""))},init:function(){i.width=m.$paddle.width();i.height=m.$paddle.height();i.top=m.height-i.height;function o(p,q){switch(p){case 37:i.keys.left=q;break;case 39:i.keys.right=q;break;case 32:i.keys.space=q}}h(document).on({keydown:function(p){o(p.which,true)},keyup:function(p){o(p.which,false)},mousedown:function(p){if(m.$container.has(p.target).length){i.keys.space=true}},mouseup:function(){i.keys.space=false}});h(document).on("mousemove",function(q){if(!m.running){return}var p=q.pageX-m.$container[0].offsetLeft;i.left=p-Math.round(i.width/2);i.refresh()})}};var a={controls:{play:{icon:"play",enabled:true,visible:true,state:true},sound:{icon:"volume-up",enabled:true,visible:typeof Audio!="undefined",state:g.settings.sound},music:{icon:"music",enabled:true,visible:typeof Audio!="undefined",state:g.settings.music}},values:{score:{label:g.texts.score,places:4},level:{label:g.texts.level,places:2},balls:{label:g.texts.balls,places:2}},message:function(o){if(typeof o=="string"){h("#breakoutMessage",m.$panel).text(o)}m.$panel.toggleClass("breakoutMessage",!!o)},highlight:function(o){var p=h(o,m.$panel);p.addClass("breakoutHighlight");setTimeout(function(){p.removeClass("breakoutHighlight")},1000)},refresh:function(){a.controls.play.state=m.running;a.controls.sound.state=g.settings.sound;a.controls.music.state=g.settings.music;h.each(a.controls,function(p,q){var o=h('.breakoutControl[data-type="'+p+'"]',m.$panel);o.attr({"data-enabled":q.enabled,"data-visible":q.visible,"data-state":q.state});if(h.browser.msie&&h.browser.version==8){o.css("margin-left",1).css("margin-left",0)}});h.each(a.values,function(o,p){var q;if(o=="level"&&m.level>m.levels.length){q=String(m.level-1)}else{q=String(m[o])}while(q.length<p.places){q="0"+q}h('[data-value="'+o+'"] .breakoutValue',m.$panel).text(q)})},render:function(){var o=['<div id="breakoutPanel">'];h.each(a.controls,function(q,r){o.push(["<div",'    class="breakoutControl"','    data-type="'+q+'"','    data-visible="'+r.visible+'"','    data-state="'+r.state+'"',">",'    <i class="icon-'+r.icon+'"></i>',"</div>",].join(""))});o.push(["<div",'    id="breakoutMessage"','    class="breakoutLast"',"></div>"].join(""));for(var p in a.values){}h.each(a.values,function(q,r){o.push(["<div",'    data-value="'+q+'"',q==p?'class="breakoutLast"':"",">",r.label,'    <div class="breakoutValue"></div>',"</div>"].join(""))});o.push("</div>");return h(o.join(""))},init:function(){m.$panel.on({mousedown:function(){var o=h(this);if(o.attr("data-enabled")=="false"){return false}o.addClass("breakoutClick");return false},mouseup:function(){var o=h(this);if(o.attr("data-enabled")=="false"){return false}o.removeClass("breakoutClick");switch(o.data("type")){case"play":m.toggle();break;case"sound":k.mute();break;case"music":k.pause("music")}a.refresh();return false}},".breakoutControl");h(document).on("keyup",function(o){switch(o.which){case 80:h('.breakoutControl[data-type="play"]',m.$panel).trigger("mouseup");break;case 83:h('.breakoutControl[data-type="sound"]',m.$panel).trigger("mouseup");break;case 77:h('.breakoutControl[data-type="music"]',m.$panel).trigger("mouseup")}})}};var b={bricks:[],coords:[],remains:0,width:0,height:0,brick:{width:43,height:23},next:function(){f.hide();m.running=false;k.play("applause");if(++m.level<=m.levels.length){d.show(g.texts.level+" "+m.level,function(){b.refresh();d.hide(function(){m.running=true})})}else{d.show(g.texts.win)}},crack:function(o,r,q){var p=m.$bricks.eq(r*b.width+o);switch(b.bricks[r][o]){case 7:if(!q){k.play("bounce")}return;case 6:k.play("brick");b.bricks[r][o]=8;p.attr("data-type",8);if(h.browser.msie&&h.browser.version==8){p.css("margin-left",1).css("margin-left",0)}break;default:k.play("brick");b.bricks[r][o]=0;p.fadeOut(250);m.score++;a.refresh();b.remains--;if(!b.remains){b.next()}else{if(!Math.floor(Math.random()*(q?14:7))){e.add(o,r)}}}},refresh:function(){m.$bricks.stop().hide();b.bricks=h.extend(true,[],m.levels[m.level-1]);b.width=b.bricks[0].length;b.height=b.bricks.length;b.remains=0;for(var q=0;q<b.height;q++){for(var o=0;o<b.width;o++){var p=b.bricks[q][o];m.$bricks.eq(q*b.width+o).attr("data-type",p);b.remains+=p&&p!=7?1:0}}m.$bricks.css("opacity",1).show();f.reset();e.reset();c.hide();i.type="normal";i.center();m.play()},render:function(){var p=h([]);for(var t=0;t<m.levels[0].length;t++){b.coords.push([]);for(var o=0;o<m.levels[0][0].length;o++){var q=h(["<div",'    class="breakoutBrick"','    data-type="0"',"></div>"].join(""));var s=t*(b.brick.height)+1;var r=o*(b.brick.width)+1;b.coords[t][o]={top:s,left:r,right:r+b.brick.width-2,bottom:s+b.brick.height-2};q.css({top:s,left:r});p=p.add(q)}}return p}};(function(ad,ac,ab){function aa(o){return"[object Function]"==P.call(o)}function Z(o){return"string"==typeof o}function Y(){}function X(o){return !o||"loaded"==o||"complete"==o||"uninitialized"==o}function W(){var o=O.shift();M=1,o?o.t?R(function(){("c"==o.t?L.injectCss:L.injectJs)(o.s,0,o.a,o.x,o.e,1)},0):(o(),W()):M=0}function V(B,A,z,y,x,w,v){function t(o){if(!q&&X(s.readyState)&&(ae.r=q=1,!M&&W(),s.onload=s.onreadystatechange=null,o)){"img"!=B&&R(function(){I.removeChild(s)},50);for(var r in D[A]){D[A].hasOwnProperty(r)&&D[A][r].onload()}}}var v=v||L.errorTimeout,s=ac.createElement(B),q=0,p=0,ae={t:z,s:A,e:x,a:w,x:v};1===D[A]&&(p=1,D[A]=[]),"object"==B?s.data=A:(s.src=A,s.type=B),s.width=s.height="0",s.onerror=s.onload=s.onreadystatechange=function(){t.call(this,p)},O.splice(y,0,ae),"img"!=B&&(p||2===D[A]?(I.insertBefore(s,J?null:Q),R(t,v)):D[A].push(s))}function U(p,o,s,r,q){return M=0,o=o||"j",Z(p)?V("c"==o?G:H,p,o,this.i++,s,r,q):(O.splice(this.i++,0,p),1==O.length&&W()),this}function T(){var o=L;return o.loader={load:U,i:0},o}var S=ac.documentElement,R=ad.setTimeout,Q=ac.getElementsByTagName("script")[0],P={}.toString,O=[],M=0,K="MozAppearance" in S.style,J=K&&!!ac.createRange().compareNode,I=J?S:Q.parentNode,S=ad.opera&&"[object Opera]"==P.call(ad.opera),S=!!ac.attachEvent&&!S,H=K?"object":S?"script":"img",G=S?"script":H,F=Array.isArray||function(o){return"[object Array]"==P.call(o)},E=[],D={},C={timeout:function(p,o){return o.length&&(p.timeout=o[0]),p}},N,L;L=function(q){function o(w){var w=w.split("!"),v=E.length,B=w.pop(),A=w.length,B={url:B,origUrl:B,prefixes:w},z,y,x;for(y=0;y<A;y++){x=w[y].split("="),(z=C[x.shift()])&&(B=z(B,x))}for(y=0;y<v;y++){B=E[y](B)}return B}function u(v,B,A,z,y){var x=o(v),w=x.autoCallback;x.url.split(".").pop().split("?").shift(),x.bypass||(B&&(B=aa(B)?B:B[v]||B[z]||B[v.split("/").pop().split("?")[0]]),x.instead?x.instead(v,B,A,z,y):(D[x.url]?x.noexec=!0:D[x.url]=1,A.load(x.url,x.forceCSS||!x.forceJS&&"css"==x.url.split(".").pop().split("?").shift()?"c":ab,x.noexec,x.attrs,x.timeout),(aa(B)||aa(w))&&A.load(function(){T(),B&&B(x.origUrl,y,z),w&&w(x.origUrl,y,z),D[x.url]=2})))}function t(ag,af){function ae(ah,ai){if(ah){if(Z(ah)){ai||(z=function(){var aj=[].slice.call(arguments);y.apply(this,aj),x()}),u(ah,z,af,0,B)}else{if(Object(ah)===ah){for(v in w=function(){var aj=0,ak;for(ak in ah){ah.hasOwnProperty(ak)&&aj++}return aj}(),ah){ah.hasOwnProperty(v)&&(!ai&&!--w&&(aa(z)?z=function(){var aj=[].slice.call(arguments);y.apply(this,aj),x()}:z[v]=function(aj){return function(){var ak=[].slice.call(arguments);aj&&aj.apply(this,ak),x()}}(y[v])),u(ah[v],z,af,v,B))}}}}else{!ai&&x()}}var B=!!ag.test,A=ag.load||ag.both,z=ag.callback||Y,y=z,x=ag.complete||Y,w,v;ae(B?ag.yep:ag.nope,!!A),A&&ae(A)}var s,r,p=this.yepnope.loader;if(Z(q)){u(q,0,p,0)}else{if(F(q)){for(s=0;s<q.length;s++){r=q[s],Z(r)?u(r,0,p,0):F(r)?L(r):Object(r)===r&&t(r,p)}}else{Object(q)===q&&t(q,p)}}},L.addPrefix=function(p,o){C[p]=o},L.addFilter=function(o){E.push(o)},L.errorTimeout=10000,null==ac.readyState&&ac.addEventListener&&(ac.readyState="loading",ac.addEventListener("DOMContentLoaded",N=function(){ac.removeEventListener("DOMContentLoaded",N,0),ac.readyState="complete"},0)),ad.yepnope=T(),ad.yepnope.executeStack=W,ad.yepnope.injectJs=function(x,w,v,u,t,s){var r=ac.createElement("script"),q,p,u=u||L.errorTimeout;r.src=x;for(p in v){r.setAttribute(p,v[p])}w=s?W:w||Y,r.onreadystatechange=r.onload=function(){!q&&X(r.readyState)&&(q=1,w(),r.onload=r.onreadystatechange=null)},R(function(){q||(q=1,w(1))},u),t?r.onload():Q.parentNode.insertBefore(r,Q)},ad.yepnope.injectCss=function(o,u,t,s,r,q){var s=ac.createElement("link"),p,u=q?W:u||Y;s.href=o,s.rel="stylesheet",s.type="text/css";for(p in t){s.setAttribute(p,t[p])}r||(Q.parentNode.insertBefore(s,Q),R(u,0))}})(this,document);h(m.init)})(jQuery);